<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drag and Drop Cards</title>
<style>
  .container {
    position: relative;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .card {
    margin-bottom: 10px;
    border: 1px solid #ccc;
    padding: 10px;
    cursor: grab;
    transition: transform 0.2s ease;
  }

  .popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 2px dashed #ccc;
    padding: 20px;
    background-color: #fff;
  }

  .archived {
    display: none; 
  }
</style>
</head>
<body>

<div class="container">
  <div id="popup" class="popup" ondrop="drop(event)" ondragover="allowDrop(event)">
    <h2>Popup Folder</h2>
  </div>
 
  <div id="cards" class="row"></div>
</div>

<script>
  let draggedCard = null;
  let offsetX, offsetY;

  // Function to handle drag start
  function dragStart(event) {
    draggedCard = event.target;
    const popup = document.getElementById("popup");
    popup.style.display = "block"; 

    // Calculate the offset from the mouse pointer to the top-left corner of the card
    offsetX = event.clientX - draggedCard.getBoundingClientRect().left;
    offsetY = event.clientY - draggedCard.getBoundingClientRect().top;

    event.dataTransfer.setData("text/plain", ""); // Necessary for Firefox
  }

  // Function to handle drag end
  function dragEnd(event) {
    draggedCard = null;
    const popup = document.getElementById("popup");
    popup.style.display = "none"; 
  }

  // Function to allow drop
  function allowDrop(event) {
    event.preventDefault();
  }

  // Function to handle drop
  function drop(event) {
    event.preventDefault();
    const cardsContainer = document.getElementById("cards");
  
    const archivedCard = draggedCard.cloneNode(true);
    archivedCard.classList.add("archived");
  
    archiveCard(draggedCard.id);
  
    draggedCard.parentNode.removeChild(draggedCard);
  
    cardsContainer.appendChild(archivedCard);

    // Close the popup after dropping
    const popup = document.getElementById("popup");
    popup.style.display = "none"; 
  }

  // Function to archive card
  function archiveCard(cardId) {
    let archivedCards = JSON.parse(localStorage.getItem("archivedCards")) || [];
    archivedCards.push(cardId);
    localStorage.setItem("archivedCards", JSON.stringify(archivedCards));
  }

  // Function to load cards
  function loadCards() {
    const cardsContainer = document.getElementById("cards");
    const allCards = [
      { id: "card1", text: "Card 1" },
      { id: "card2", text: "Card 2" },
      { id: "card3", text: "Card 3" },
      { id: "card4", text: "Card 4" },
      { id: "card5", text: "Card 5" }
    ];

    const archivedCardIds = JSON.parse(localStorage.getItem("archivedCards")) || [];
  
    const nonArchivedCards = allCards.filter(card => !archivedCardIds.includes(card.id));
  
    nonArchivedCards.forEach(cardData => {
      const card = document.createElement("div");
      card.textContent = cardData.text;
      card.classList.add("card");
      card.setAttribute("id", cardData.id);
      cardsContainer.appendChild(card);

      // Add event listeners for mouse and touch events
      card.addEventListener("mousedown", dragStart);
      card.addEventListener("touchstart", touchStart);

      // Archive the card after inserting it
      archiveCard(cardData.id);
    });

    // Close the popup after loading cards
    const popup = document.getElementById("popup");
    popup.style.display = "none"; 
  }

  function mouseMove(event) {
    event.preventDefault();
    if (draggedCard) {
      draggedCard.style.position = "fixed";
      draggedCard.style.left = (event.clientX - offsetX) + "px";
      draggedCard.style.top = (event.clientY - offsetY) + "px";
    }
  }

  function mouseUp(event) {
    event.preventDefault();
    if (draggedCard) {
      drop(event);
      draggedCard.style.position = "";
      draggedCard.style.left = "";
      draggedCard.style.top = "";
      window.removeEventListener("mousemove", mouseMove);
      window.removeEventListener("mouseup", mouseUp);
    }
  }

  function touchMove(event) {
    event.preventDefault();
    if (draggedCard) {
      const touch = event.touches[0];
      draggedCard.style.left = (touch.clientX - offsetX) + "px";
      draggedCard.style.top = (touch.clientY - offsetY) + "px";
    }
  }

  function touchEnd(event) {
    event.preventDefault();
    if (draggedCard) {
      drop(event);
      draggedCard.style.position = "";
      draggedCard.style.left = "";
      draggedCard.style.top = "";
      window.removeEventListener("touchmove", touchMove);
      window.removeEventListener("touchend", touchEnd);
    }
  }

  function touchStart(event) {
    event.preventDefault();
    draggedCard = event.target;
    const touch = event.touches[0];
    const popup = document.getElementById("popup");
    popup.style.display = "block"; 
    offsetX = touch.clientX - draggedCard.getBoundingClientRect().left;
    offsetY = touch.clientY - draggedCard.getBoundingClientRect().top;
    draggedCard.style.position = "fixed";
    draggedCard.style.left = (touch.clientX - offsetX) + "px";
    draggedCard.style.top = (touch.clientY - offsetY) + "px";
    window.addEventListener("touchmove", touchMove);
    window.addEventListener("touchend", touchEnd);
  }

  document.addEventListener("DOMContentLoaded", loadCards);
  window.addEventListener("mousemove", mouseMove);
  window.addEventListener("mouseup", mouseUp);
</script>

</body>
</html>

